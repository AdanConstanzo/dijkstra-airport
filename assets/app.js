function Set(){this.values=[],this.numberOfValues=0}angular.module("app",["ngRoute"]),angular.module("app").controller("AirportCtrl",["$scope","AirportSvc",function(h,i){var a=new E,c=new E,d={},v=new t;h.called=!1;var A=document.getElementById("dijk");A.disabled=!0;var s,g={},l={},f=[],p={},n=document.getElementById("from-form"),r=document.getElementById("to-form");function u(){0==n.value.length&&0==r.value.length?n.value=this.title:0<n.value.length&&0==r.value.length&&(r.value=this.title)}function m(t,e){d[t]=e}i.getAirports().then(function(t){h.Airports=t;s=new google.maps.Map(document.getElementById("map"),{zoom:8,center:{lat:33.942536,lng:-118.408075}});for(var e,n=h.Airports.length,r=0;r<n;r++){v.addVertex(h.Airports[r].IATA),g[h.Airports[r].IATA]=h.Airports[r],d[h.Airports[r].IATA]=Number.MAX_VALUE,a.add(h.Airports[r].IATA),c.add(h.Airports[r].IATA);var o={lat:h.Airports[r].LAT,lng:h.Airports[r].LON};(e=new google.maps.Marker({position:o,map:s,title:h.Airports[r].IATA})).addListener("click",u,!1),l[h.Airports[r].IATA]=e}i.getRoutes().then(function(t){for(var e=0;e<t.length;e++)p[t[e].From+"-"+t[e].From]=t[e].Airport,v.addEdge(t[e].From,t[e].To,t[e].Distance);A.disabled=!1})}),h.Dijkstra=function(){var t=document.getElementById("from-form"),e=document.getElementById("to-form");!function(t,e){var n=!1;if(3==t.value.length&&3==e.value.length){for(var r=0;r<a.length();r++)if(a.at(r)==t.value){n=!0;break}n=!1;for(var r=0;r<a.length();r++)if(a.at(r)==e.value){n=!0;break}}return n}(t,e)||o(t.value,e.value)};var o=function(t,e){var n={};for(A.disabled=!0,h.called?b(c,d):h.called=!0,m(t,0);0<c.length();){var r=O();if(e==r)break;c.remove(r);for(var o=v.GetNeigh(r),i=0;i<o.length;i++){var a=d[r]+o[i].distance,u=Math.round(10*a)/10,s=o[i].to;u<d[s]&&(m(s,u),n[s]=r)}}for(var l=[],f=e;l.unshift(f),null!=(f=n[f]););var p=[];for(i=0;i<l.length;i++)p.push(g[l[i]]);T(p),A.disabled=!1};function I(t){for(var e=0;e<h.Airports.length;e++)l[h.Airports[e].IATA].setMap(t)}function y(t,e){for(var n=v.GetNeigh(t),r=0;r<n.length;r++)if(n[r].to==e)return n[r]}var T=function(t){var e=document.getElementById("result"),n={path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW};I(null);for(var r=0;r<t.length;r++){var o=document.createElement("p");if(0==r)var i=y(t[r].IATA,t[r+1].IATA),a="Leave "+t[r].IATA+"("+t[r].Name+") on "+p[t[r].IATA+"-"+t[r].IATA]+"  after flying "+i.distance+" km";else if(r==t.length-1)a="Arrive at "+t[r].IATA+"("+t[r].Name+")";else i=y(t[r].IATA,t[r+1].IATA),a="Change planes at "+t[r].IATA+"("+t[r].Name+") to "+p[t[r].IATA+"-"+t[r].IATA]+" and fly "+i.distance+" km";o.innerHTML+=a,e.appendChild(o)}for(r=0;r<t.length-1;r++){l[t[r].IATA].setMap(s),l[t[r+1].IATA].setMap(s);var u=new google.maps.Polyline({path:[{lat:t[r].LAT,lng:t[r].LON},{lat:t[r+1].LAT,lng:t[r+1].LON}],icons:[{icon:n,offset:"100%"}],map:s});f.push(u)}},O=function(){for(var t,e=d[c.at(0)],n=0;n<c.length();n++)d[c.at(n)]<=e&&(e=d[c.at(n)],t=c.at(n));return t},b=function(t,e){new E;for(var n=0;n<h.Airports.length;n++)d[h.Airports[n].IATA]=Number.MAX_VALUE,c.add(h.Airports[n].IATA)};function t(){this.vertices=[],this.edges=[],this.numberOfEdges=0}function E(){this.values=[],this.numberOfValues=0}h.clickRepeat=function(){for(var t=0;t<f.length;t++)f[t].setMap(null);I(s),r.value="",n.value="";for(var e=document.getElementById("result");e.hasChildNodes();)e.removeChild(e.lastChild)},t.prototype.addVertex=function(t){-1==this.vertices.indexOf(t)&&(this.vertices.push(t),this.edges[t]=[])},t.prototype.addEdge=function(t,e,n){var r={to:e,distance:n};this.edges[t].push(r),this.numberOfEdges++},t.prototype.size=function(){return this.vertices.length},t.prototype.GetNeigh=function(t){return this.edges[t]},E.prototype.at=function(t){return this.values[t]},E.prototype.add=function(t){~this.values.indexOf(t)||(this.values.push(t),this.numberOfValues++)},E.prototype.remove=function(t){var e=this.values.indexOf(t);~e&&(this.values.splice(e,1),this.numberOfValues--)},E.prototype.length=function(){return this.numberOfValues}}]),angular.module("app").config(["$routeProvider",function(t){t.when("/",{controller:"AirportCtrl",templateUrl:"/templates/home.html"})}]),angular.module("app").service("AirportSvc",["$http",function(e){this.getAirports=function(){return e.get("/api/airports/").then(function(t){return t.data})},this.getRoutes=function(){return e.get("/api/routes/").then(function(t){return t.data})},this.getOneAirport=function(t){return e.get("/api/airports/"+t).then(function(t){return t.data})}}]),Set.prototype.add=function(t){~this.values.indexOf(t)||(this.values.push(t),this.numberOfValues++)},Set.prototype.remove=function(t){var e=this.values.indexOf(t);~e&&(this.values.splice(e,1),this.numberOfValues--)},Set.prototype.contains=function(t){return-1!==this.values.indexOf(t)},Set.prototype.union=function(t){var e=new Set;return t.values.forEach(function(t){e.add(t)}),this.values.forEach(function(t){e.add(t)}),e},Set.prototype.intersect=function(e){var n=new Set;return this.values.forEach(function(t){e.contains(t)&&n.add(t)}),n},Set.prototype.difference=function(e){var n=new Set;return this.values.forEach(function(t){e.contains(t)||n.add(t)}),n},Set.prototype.isSubset=function(t){return t.values.every(function(t){return this.contains(t)},this)},Set.prototype.length=function(){return this.numberOfValues},Set.prototype.print=function(){console.log(this.values.join(" "))};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNldC5qcyIsIm1vZHVsZS5qcyIsIkFpcnBvcnRzLmN0cmwuanMiLCJSb3V0ZXMuanMiLCJhaXJwb3J0cy5zdmMuanMiXSwibmFtZXMiOlsiU2V0IiwidGhpcyIsInZhbHVlcyIsIm51bWJlck9mVmFsdWVzIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbnRyb2xsZXIiLCIkc2NvcGUiLCJBaXJwb3J0U3ZjIiwic2V0X2FpcnBvcnRzIiwidW52aXNpdGVkIiwiZGlzdGFuY2UiLCJncmFwaCIsIkdyYXBoIiwiY2FsbGVkIiwiYnV0dG9uIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImRpc2FibGVkIiwibWFwIiwiYWlyIiwibWFya2VycyIsImxpbmVzIiwiQWlybGluZSIsImdldEZyb20iLCJnZXRUbyIsInNldElBVEEiLCJ2YWx1ZSIsImxlbmd0aCIsInRpdGxlIiwic2V0VmFsdWUiLCJfSUFUQSIsIl9XRUlHSFQiLCJnZXRBaXJwb3J0cyIsInRoZW4iLCJwcm9kdWN0IiwiQWlycG9ydHMiLCJnb29nbGUiLCJtYXBzIiwiTWFwIiwiem9vbSIsImNlbnRlciIsImxhdCIsImxuZyIsIm1hcmtlciIsImxvb3BMZW5naHQiLCJpIiwiYWRkVmVydGV4IiwiSUFUQSIsIk51bWJlciIsIk1BWF9WQUxVRSIsImFkZCIsIm5ld01hcmsiLCJMQVQiLCJMT04iLCJNYXJrZXIiLCJwb3NpdGlvbiIsImFkZExpc3RlbmVyIiwiZ2V0Um91dGVzIiwicm91dGVzIiwiRnJvbSIsIkFpcnBvcnQiLCJhZGRFZGdlIiwiVG8iLCJEaXN0YW5jZSIsIkRpamtzdHJhIiwiZnJvbSIsInRvIiwiY2hlY2siLCJhdCIsImNoZWNrVmFsdWVzIiwicnVuRGlqa3N0cmEiLCJwcmV2aW91cyIsInJlc2V0VmFyaWFibGUiLCJhIiwiZ2V0TWluIiwicmVtb3ZlIiwibmVpZ2giLCJHZXROZWlnaCIsImFsdCIsInJvdW5kIiwiTWF0aCIsImtleSIsIlMiLCJ1IiwidW5zaGlmdCIsInVuZGVmaW5lZCIsInRlbXAiLCJwdXNoIiwiZG9WaWV3Iiwic2V0TWFwT25BbGwiLCJzZXRNYXAiLCJnZXREaXN0YW5jZSIsImFpcl9vYmoiLCJkaXZSZXN1bHQiLCJsaW5lU3ltYm9sIiwicGF0aCIsIlN5bWJvbFBhdGgiLCJGT1JXQVJEX0NMT1NFRF9BUlJPVyIsInAiLCJjcmVhdGVFbGVtZW50IiwiY3VycmVudCIsIk5hbWUiLCJpbm5lckhUTUwiLCJhcHBlbmRDaGlsZCIsImxpbmUiLCJQb2x5bGluZSIsImljb25zIiwiaWNvbiIsIm9mZnNldCIsImN1cnJlbnRLZXkiLCJjdXJyZW50TWluIiwiX3VudmlzaXRlZCIsIl9kaXN0YW5jZSIsInZlcnRpY2VzIiwiZWRnZXMiLCJudW1iZXJPZkVkZ2VzIiwiY2xpY2tSZXBlYXQiLCJkaXYiLCJoYXNDaGlsZE5vZGVzIiwicmVtb3ZlQ2hpbGQiLCJsYXN0Q2hpbGQiLCJwcm90b3R5cGUiLCJ2ZXJ0ZXgiLCJpbmRleE9mIiwidmVydGV4MSIsInZlcnRleDIiLCJfZCIsInNpemUiLCJpbmRleCIsInNwbGljZSIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwid2hlbiIsInRlbXBsYXRlVXJsIiwic2VydmljZSIsIiRodHRwIiwiZ2V0IiwicmVzcG9uc2UiLCJkYXRhIiwiZ2V0T25lQWlycG9ydCIsImNvbnRhaW5zIiwidW5pb24iLCJzZXQiLCJuZXdTZXQiLCJmb3JFYWNoIiwiaW50ZXJzZWN0IiwiZGlmZmVyZW5jZSIsImlzU3Vic2V0IiwiZXZlcnkiLCJwcmludCIsImNvbnNvbGUiLCJsb2ciLCJqb2luIl0sIm1hcHBpbmdzIjoiQUFBQSxTQUFTQSxNQUNQQyxLQUFLQyxPQUFTLEdBQ2RELEtBQUtFLGVBQWlCLEVDRHhCQyxRQUFRQyxPQUFPLE1BQU0sQ0FDakIsWUNGSkQsUUFBUUMsT0FBTyxPQUFPQyxXQUFXLGNBQUEsQ0FBQSxTQUFBLGFBQWUsU0FBVUMsRUFBT0MsR0FHN0QsSUFBSUMsRUFBZSxJQUFJVCxFQUVuQlUsRUFBWSxJQUFJVixFQUVoQlcsRUFBVyxH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LElBTWpCLE9BTEFDLEtBQUtDLE9BQU8rSSxRQUFRLFNBQVN0SCxHQUN4Qm9ILEVBQUlGLFNBQVNsSCxJQUNkcUgsRUFBTzdGLElBQUl4QixLQUdScUgsR0FFVGhKLElBQUkwSCxVQUFVeUIsV0FBYSxTQUFTSixHQUNsQyxJQUFJQyxFQUFTLElBQUloSixJQU1qQixPQUxBQyxLQUFLQyxPQUFPK0ksUUFBUSxTQUFTdEgsR0FDdkJvSCxFQUFJRixTQUFTbEgsSUFDZnFILEVBQU83RixJQUFJeEIsS0FHUnFILEdBRVRoSixJQUFJMEgsVUFBVTBCLFNBQVcsU0FBU0wsR0FDaEMsT0FBT0EsRUFBSTdJLE9BQU9tSixNQUFNLFNBQVMxSCxHQUMvQixPQUFPMUIsS0FBSzRJLFNBQVNsSCxJQUNwQjFCLE9BRUxELElBQUkwSCxVQUFVOUYsT0FBUyxXQUNyQixPQUFPM0IsS0FBS0UsZ0JBRWRILElBQUkwSCxVQUFVNEIsTUFBUSxXQUNwQkMsUUFBUUMsSUFBSXZKLEtBQUtDLE9BQU91SixLQUFLIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIFNldCgpIHtcbiAgdGhpcy52YWx1ZXMgPSBbXTtcbiAgdGhpcy5udW1iZXJPZlZhbHVlcyA9IDA7XG59XG5cblNldC5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgaWYoIX50aGlzLnZhbHVlcy5pbmRleE9mKHZhbHVlKSkge1xuICAgIHRoaXMudmFsdWVzLnB1c2godmFsdWUpO1xuICAgIHRoaXMubnVtYmVyT2ZWYWx1ZXMrKztcbiAgfVxufTtcblNldC5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgdmFyIGluZGV4ID0gdGhpcy52YWx1ZXMuaW5kZXhPZih2YWx1ZSk7XG4gIGlmKH5pbmRleCkge1xuICAgIHRoaXMudmFsdWVzLnNwbGljZShpbmRleCwgMSk7XG4gICAgdGhpcy5udW1iZXJPZlZhbHVlcy0tO1xuICB9XG59O1xuU2V0LnByb3RvdHlwZS5jb250YWlucyA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gIHJldHVybiB0aGlzLnZhbHVlcy5pbmRleE9mKHZhbHVlKSAhPT0gLTE7XG59O1xuU2V0LnByb3RvdHlwZS51bmlvbiA9IGZ1bmN0aW9uKHNldCkge1xuICB2YXIgbmV3U2V0ID0gbmV3IFNldCgpO1xuICBzZXQudmFsdWVzLmZvckVhY2goZnVuY3Rpb24odmFsdWUpIHtcbiAgICBuZXdTZXQuYWRkKHZhbHVlKTtcbiAgfSk7XG4gIHRoaXMudmFsdWVzLmZvckVhY2goZnVuY3Rpb24odmFsdWUpIHtcbiAgICBuZXdTZXQuYWRkKHZhbHVlKTtcbiAgfSk7XG4gIHJldHVybiBuZXdTZXQ7XG59O1xuU2V0LnByb3RvdHlwZS5pbnRlcnNlY3QgPSBmdW5jdGlvbihzZXQpIHtcbiAgdmFyIG5ld1NldCA9IG5ldyBTZXQoKTtcbiAgdGhpcy52YWx1ZXMuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSkge1xuICAgIGlmKHNldC5jb250YWlucyh2YWx1ZSkpIHtcbiAgICAgIG5ld1NldC5hZGQodmFsdWUpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBuZXdTZXQ7XG59O1xuU2V0LnByb3RvdHlwZS5kaWZmZXJlbmNlID0gZnVuY3Rpb24oc2V0KSB7XG4gIHZhciBuZXdTZXQgPSBuZXcgU2V0KCk7XG4gIHRoaXMudmFsdWVzLmZvckVhY2goZnVuY3Rpb24odmFsdWUpIHtcbiAgICBpZighc2V0LmNvbnRhaW5zKHZhbHVlKSkge1xuICAgICAgbmV3U2V0LmFkZCh2YWx1ZSk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIG5ld1NldDtcbn07XG5TZXQucHJvdG90eXBlLmlzU3Vic2V0ID0gZnVuY3Rpb24oc2V0KSB7XG4gIHJldHVybiBzZXQudmFsdWVzLmV2ZXJ5KGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgcmV0dXJuIHRoaXMuY29udGFpbnModmFsdWUpO1xuICB9LCB0aGlzKTtcbn07XG5TZXQucHJvdG90eXBlLmxlbmd0aCA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gdGhpcy5udW1iZXJPZlZhbHVlcztcbn07XG5TZXQucHJvdG90eXBlLnByaW50ID0gZnVuY3Rpb24oKSB7XG4gIGNvbnNvbGUubG9nKHRoaXMudmFsdWVzLmpvaW4oJyAnKSk7XG59OyIsIi8vIG5lZWRlZCB0byBjcmVhdGUgZ3VscCBzZXhpbmVzc1xuYW5ndWxhci5tb2R1bGUoJ2FwcCcsW1xuICAgICduZ1JvdXRlJ1xuXSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnRyb2xsZXIoJ0FpcnBvcnRDdHJsJywgZnVuY3Rpb24gKCRzY29wZSxBaXJwb3J0U3ZjKSB7XG5cbiAgICAvL0NoZWNrIG91ciB2YWx1ZXNcbiAgICB2YXIgc2V0X2FpcnBvcnRzID0gbmV3IFNldCgpO1xuICAgIC8vIG91ciB1bnZpc2l0ZWQgc2V0LlxuICAgIHZhciB1bnZpc2l0ZWQgPSBuZXcgU2V0KCk7XG4gICAgLy8gb3VyIGRpc3RhbmNlIG9iamVjdFxuICAgIHZhciBkaXN0YW5jZSA9IHt9O1xuICAgIC8vIE91ciBHcmFwaFxuICAgIHZhciBncmFwaCA9IG5ldyBHcmFwaCgpO1xuICAgIC8vIGJvb2xlYW4gdG8gY2hlY2sgZm9yIG11bGlwbGUgY2FsbHNcbiAgICAkc2NvcGUuY2FsbGVkID0gZmFsc2U7XG4gICAgLy8gYSBidXR0b25cbiAgICB2YXIgYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkaWprXCIpO1xuICAgIGJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG5cbiAgICAvLyBvYmplY3QgdG8gc2V0IGtleSB2YWx1ZSBvZiBJQVRBIGFuZCB0aGUgYWN0dWFsIG9iamVjdFxuICAgIHZhciBhaXIgPSB7fTtcbiAgICAvLyBvdXIgY29tcGxldGVkIG9iamVjdFxuICAgIHZhciBjb21wbGV0ZWQgPSBbXTtcbiAgICAvLyBUaGlzIGlzIEdvb2dsZSBNYXAgT2JqZWN0LlxuICAgIHZhciBtYXA7XG4gICAgLy8gT2JqZWN0IGZvciBvdXIgbWFya2Vycy5cbiAgICB2YXIgbWFya2VycyA9IHt9O1xuICAgIC8vIEFycmF5IGZvciB0aGUgbGluZXMuXG4gICAgdmFyIGxpbmVzID0gW107XG4gICAgLy8gQWlybGluIE9iamVjdFxuICAgIHZhciBBaXJsaW5lID0ge307XG4gICAgLy8gb3VyIGlucHV0IHZhcmlhYmxlc1xuICAgIHZhciBnZXRGcm9tID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJmcm9tLWZvcm1cIik7XG4gICAgdmFyIGdldFRvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0by1mb3JtXCIpO1xuICAgIC8vIEdyYWJzIGFpcnBvcnRzIGFzeW5jaHJvbm91c2x5LlxuICAgIEFpcnBvcnRTdmMuZ2V0QWlycG9ydHMoKVxuICAgIC50aGVuKGZ1bmN0aW9uKHByb2R1Y3QpXG4gICAge1xuICAgICAgICAkc2NvcGUuQWlycG9ydHMgPSBwcm9kdWN0O1xuICAgICAgICB2YXIgbGF4ID0ge2xhdDozMy45NDI1MzYsbG5nOi0xMTguNDA4MDc1fTtcbiAgICAgICAgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJykse1xuICAgICAgICBcdHpvb206OCxcbiAgICAgICAgXHRjZW50ZXI6IGxheFxuICAgICAgICB9KTtcbiAgICAgICAgdmFyIGxvb3BMZW5naHQgPSAkc2NvcGUuQWlycG9ydHMubGVuZ3RoO1xuICAgICAgICB2YXIgbWFya2VyO1xuICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgbG9vcExlbmdodDsgaSsrKVxuICAgICAgICB7XG4gICAgICAgICAgICBncmFwaC5hZGRWZXJ0ZXgoJHNjb3BlLkFpcnBvcnRzW2ldLklBVEEpO1xuICAgICAgICAgICAgYWlyWyRzY29wZS5BaXJwb3J0c1tpXS5JQVRBXSA9ICRzY29wZS5BaXJwb3J0c1tpXTtcbiAgICAgICAgICAgIGRpc3RhbmNlWyRzY29wZS5BaXJwb3J0c1tpXS5JQVRBXSA9IE51bWJlci5NQVhfVkFMVUU7XG4gICAgICAgICAgICBzZXRfYWlycG9ydHMuYWRkKCRzY29wZS5BaXJwb3J0c1tpXS5JQVRBKTtcbiAgICAgICAgICAgIHVudmlzaXRlZC5hZGQoJHNjb3BlLkFpcnBvcnRzW2ldLklBVEEpO1xuICAgICAgICBcdHZhciBuZXdNYXJrID0ge2xhdDogJHNjb3BlLkFpcnBvcnRzW2ldLkxBVCxsbmc6JHNjb3BlLkFpcnBvcnRzW2ldLkxPTn07XG4gICAgICAgIFx0bWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICAgIFx0XHRwb3NpdGlvbjpuZXdNYXJrLFxuICAgICAgICBcdFx0bWFwOm1hcCxcbiAgICAgICAgXHRcdHRpdGxlOiAkc2NvcGUuQWlycG9ydHNbaV0uSUFUQVxuICAgICAgICBcdH0pO1xuICAgICAgICBcdG1hcmtlci5hZGRMaXN0ZW5lcignY2xpY2snLHNldElBVEEsZmFsc2UpO1xuICAgICAgICAgICAgbWFya2Vyc1skc2NvcGUuQWlycG9ydHNbaV0uSUFUQV0gPSBtYXJrZXI7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIEFpcnBvcnRTdmMuZ2V0Um91dGVzKClcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24ocm91dGVzKVxuICAgICAgICB7XG4gICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgcm91dGVzLmxlbmd0aDsgaSsrKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIEFpcmxpbmVbcm91dGVzW2ldLkZyb20rJy0nK3JvdXRlc1tpXS5Gcm9tXSA9IHJvdXRlc1tpXS5BaXJwb3J0O1xuICAgICAgICAgICAgICAgIGdyYXBoLmFkZEVkZ2Uocm91dGVzW2ldLkZyb20scm91dGVzW2ldLlRvLHJvdXRlc1tpXS5EaXN0YW5jZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICB9KVxuICAgIH0pO1xuXG4gICAgXG4gICAgXG5cbiAgICAvLyBTZXQgdGhlIHZhbHVlcyBvZiBhaXJwb3J0c1xuICAgIGZ1bmN0aW9uIHNldElBVEEoKSB7XG4gICAgICAgIGlmKGdldEZyb20udmFsdWUubGVuZ3RoID09IDAgJiYgZ2V0VG8udmFsdWUubGVuZ3RoID09IDApXG4gICAgICAgICAgICBnZXRGcm9tLnZhbHVlID0gdGhpcy50aXRsZTtcbiAgICAgICAgZWxzZSBpZiAoIGdldEZyb20udmFsdWUubGVuZ3RoID4gMCAmJiBnZXRUby52YWx1ZS5sZW5ndGggPT0gMClcbiAgICAgICAgICAgIGdldFRvLnZhbHVlID0gdGhpcy50aXRsZTtcblx0fVxuXG4gICAgLy8gRGlqa3N0cmEgQWxnb2lydGhtIENhbGxlclxuICAgICRzY29wZS5EaWprc3RyYSA9IGZ1bmN0aW9uKClcbiAgICB7XG4gICAgICAgIHZhciBnZXRGcm9tID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJmcm9tLWZvcm1cIik7XG4gICAgICAgIHZhciBnZXRUbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidG8tZm9ybVwiKTtcbiAgICAgICAgaWYoY2hlY2tWYWx1ZXMoZ2V0RnJvbSxnZXRUbykpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHJ1bkRpamtzdHJhKGdldEZyb20udmFsdWUsZ2V0VG8udmFsdWUpOyAgIFxuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAge1xuICAgICAgICAgICAgLy8gaGFuZGxlIGVycm9yXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBib29sIHRvIGNoZWNrIHdoZXRoZXIgaWYgbm90IGJsYW5rIFxuXHRmdW5jdGlvbiBjaGVja1ZhbHVlcyhmcm9tLHRvKVxuICAgIHtcbiAgICAgICAgdmFyIGNoZWNrID1mYWxzZTtcbiAgICAgICAgaWYoZnJvbS52YWx1ZS5sZW5ndGggPT0gMyAmJiB0by52YWx1ZS5sZW5ndGggPT0gMylcbiAgICAgICAge1xuICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHNldF9haXJwb3J0cy5sZW5ndGgoKTsgaSsrKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlmKHNldF9haXJwb3J0cy5hdChpKSA9PSBmcm9tLnZhbHVlKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgY2hlY2sgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjaGVjayA9IGZhbHNlO1xuICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHNldF9haXJwb3J0cy5sZW5ndGgoKTsgaSsrKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlmKHNldF9haXJwb3J0cy5hdChpKSA9PSB0by52YWx1ZSlcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGNoZWNrID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjaGVjaztcbiAgICB9XG4gICAgZnVuY3Rpb24gc2V0VmFsdWUoX0lBVEEsX1dFSUdIVClcbiAgICB7XG4gICAgICAgIGRpc3RhbmNlW19JQVRBXSA9IF9XRUlHSFQ7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGdldFZhbHVlKF9JQVRBKVxuICAgIHtcbiAgICAgICAgcmV0dXJuIGRpc3RhbmNlW19JQVRBXTtcbiAgICB9XG5cbiAgICB2YXIgcnVuRGlqa3N0cmEgPSBmdW5jdGlvbihmcm9tLHRvKVxuICAgIHtcbiAgICAgICAgXG4gICAgICAgIHZhciBwcmV2aW91cyA9IHt9O1xuICAgICAgICBidXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAvLyBSZXNldCBDaGVja2VyLlxuICAgICAgICBpZigkc2NvcGUuY2FsbGVkKVxuICAgICAgICAgICAgcmVzZXRWYXJpYWJsZSh1bnZpc2l0ZWQsZGlzdGFuY2UpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICAkc2NvcGUuY2FsbGVkID0gdHJ1ZTtcblxuICAgICAgICBzZXRWYWx1ZShmcm9tLDApO1xuXG4gICAgICAgIHdoaWxlKHVudmlzaXRlZC5sZW5ndGgoKSA+IDApXG4gICAgICAgIHtcbiAgICAgICAgICAgIHZhciBhID0gZ2V0TWluKCk7XG4gICAgICAgICAgICBpZiggdG8gPT0gYSApXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB1bnZpc2l0ZWQucmVtb3ZlKGEpO1xuICAgICAgICAgICAgdmFyIG5laWdoID0gZ3JhcGguR2V0TmVpZ2goYSk7XG4gICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgbmVpZ2gubGVuZ3RoOyBpKyspXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgLy92YXIgcm91bmRlZCA9IE1hdGgucm91bmQoIG51bWJlciAqIDEwICkgLyAxMDtcbiAgICAgICAgICAgICAgICB2YXIgYWx0ID0gZGlzdGFuY2VbYV0gKyBuZWlnaFtpXS5kaXN0YW5jZTtcbiAgICAgICAgICAgICAgICB2YXIgcm91bmQgPSBNYXRoLnJvdW5kKGFsdCoxMCkvMTA7XG4gICAgICAgICAgICAgICAgdmFyIGtleSA9IG5laWdoW2ldLnRvXG4gICAgICAgICAgICAgICAgaWYocm91bmQgPCBnZXRWYWx1ZShrZXkpKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VmFsdWUoa2V5LHJvdW5kKTtcbiAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNba2V5XSA9IGE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cbiAgICAgICAgdmFyIFMgPSBbXTtcbiAgICAgICAgdmFyIHUgPSB0bztcbiAgICAgICAgd2hpbGUodHJ1ZSlcbiAgICAgICAge1xuICAgICAgICAgICAgUy51bnNoaWZ0KHUpO1xuICAgICAgICAgICAgdSA9IHByZXZpb3VzW3VdO1xuICAgICAgICAgICAgaWYodSA9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHRlbXAgPSBbXTtcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IFMubGVuZ3RoOyBpKyspXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRlbXAucHVzaChhaXJbU1tpXV0pO1xuICAgICAgICB9XG4gICAgICAgIGRvVmlldyh0ZW1wKTtcbiAgICAgICAgYnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIFxuICAgIH1cbiAgICAvLyBHb29nbGUncyBDb2RlXG4gICAgZnVuY3Rpb24gc2V0TWFwT25BbGwobWFwKSB7XG4gICAgICAgIGZvcih2YXIgaSA9IDAgOyBpIDwgJHNjb3BlLkFpcnBvcnRzLmxlbmd0aDsgaSsrKVxuICAgICAgICB7XG4gICAgICAgICAgICBtYXJrZXJzWyRzY29wZS5BaXJwb3J0c1tpXS5JQVRBXS5zZXRNYXAobWFwKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKlxuICAgICAgICBMZWF2ZSBMQVggKExvcyBBbmdlbGVzKSBvbiBBbWVyaWNhbiBBaXJ3YXlzIGFmdGVyIGZseWluZyAyLDUwMCBtaWxlc1xuICAgICAgICBDaGFuZ2UgcGxhbmVzIGF0IEFOVCAoQXRsYW50YSkgdG8gQW1lcmljYW4gQWlybGluZXMgYW5kIGZseSAxLDAwMCBtaWxlc1xuICAgICovXG4gICAgdmFyIGdldERpc3RhbmNlID0gZnVuY3Rpb24oZnJvbSx0bylcbiAgICB7XG4gICAgICAgIHZhciBuZWlnaCA9IGdyYXBoLkdldE5laWdoKGZyb20pO1xuICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgbmVpZ2gubGVuZ3RoOyBpKyspXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlmKG5laWdoW2ldLnRvID09IHRvKVxuICAgICAgICAgICAgICAgIHJldHVybiBuZWlnaFtpXVxuICAgICAgICB9XG4gICAgfVxuICAgIHZhciBkb1ZpZXcgPSBmdW5jdGlvbihhaXJfb2JqKVxuICAgIHtcbiAgICAgICAgdmFyIGRpdlJlc3VsdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzdWx0XCIpO1xuICAgICAgICB2YXIgbGluZVN5bWJvbCA9IHtcbiAgICAgICAgICBwYXRoOiBnb29nbGUubWFwcy5TeW1ib2xQYXRoLkZPUldBUkRfQ0xPU0VEX0FSUk9XXG4gICAgICAgIH07XG4gICAgICAgIHNldE1hcE9uQWxsKG51bGwpO1xuXG4gICAgICAgIC8vIGxvb3AgZm9yIHRleHQgdG8gc2hvd1xuXG4gICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBhaXJfb2JqLmxlbmd0aDsgaSsrKVxuICAgICAgICB7XG4gICAgICAgICAgICB2YXIgcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICAgICAgICAgIGlmKGkgPT0gMClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YXIgZGlzdGFuY2UgPSBnZXREaXN0YW5jZShhaXJfb2JqW2ldLklBVEEsYWlyX29ialtpKzFdLklBVEEpO1xuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50ID0gXCJMZWF2ZSBcIithaXJfb2JqW2ldLklBVEErXCIoXCIrYWlyX29ialtpXS5OYW1lK1wiKSBvbiBcIitBaXJsaW5lW2Fpcl9vYmpbaV0uSUFUQSsnLScrYWlyX29ialtpXS5JQVRBXStcIiAgYWZ0ZXIgZmx5aW5nIFwiK2Rpc3RhbmNlLmRpc3RhbmNlK1wiIGttXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKGkgPT0gYWlyX29iai5sZW5ndGgtMSlcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudCA9IFwiQXJyaXZlIGF0IFwiK2Fpcl9vYmpbaV0uSUFUQStcIihcIithaXJfb2JqW2ldLk5hbWUrXCIpXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFyIGRpc3RhbmNlID0gZ2V0RGlzdGFuY2UoYWlyX29ialtpXS5JQVRBLGFpcl9vYmpbaSsxXS5JQVRBKTtcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudCA9IFwiQ2hhbmdlIHBsYW5lcyBhdCBcIithaXJfb2JqW2ldLklBVEErXCIoXCIrYWlyX29ialtpXS5OYW1lK1wiKSB0byBcIitBaXJsaW5lW2Fpcl9vYmpbaV0uSUFUQSsnLScrYWlyX29ialtpXS5JQVRBXStcIiBhbmQgZmx5IFwiK2Rpc3RhbmNlLmRpc3RhbmNlK1wiIGttXCI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHAuaW5uZXJIVE1MKz0gY3VycmVudDtcbiAgICAgICAgICAgIGRpdlJlc3VsdC5hcHBlbmRDaGlsZChwKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gbG9vcCBmb3IgbWFwIHN0dWZmXG4gICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBhaXJfb2JqLmxlbmd0aC0xOyBpKyspXG4gICAgICAgIHtcbiAgICAgICAgICAgIG1hcmtlcnNbYWlyX29ialtpXS5JQVRBXS5zZXRNYXAobWFwKTtcbiAgICAgICAgICAgIG1hcmtlcnNbYWlyX29ialtpKzFdLklBVEFdLnNldE1hcChtYXApO1xuICAgICAgICAgICAgdmFyIGxpbmUgPSBuZXcgZ29vZ2xlLm1hcHMuUG9seWxpbmUoe1xuICAgICAgICAgICAgICBwYXRoOiBbIHtsYXQ6IGFpcl9vYmpbaV0uTEFULCBsbmc6IGFpcl9vYmpbaV0uTE9OfSwge2xhdDogYWlyX29ialtpKzFdLkxBVCwgbG5nOiBhaXJfb2JqW2krMV0uTE9OfV0sXG4gICAgICAgICAgICAgIGljb25zOiBbe1xuICAgICAgICAgICAgICAgIGljb246IGxpbmVTeW1ib2wsXG4gICAgICAgICAgICAgICAgb2Zmc2V0OiAnMTAwJSdcbiAgICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICAgIG1hcDogbWFwXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGxpbmVzLnB1c2gobGluZSk7XG5cbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBHZXQgTWluIEZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgbG93ZXN0IHZhbHVlLlxuICAgIHZhciBnZXRNaW4gPSBmdW5jdGlvbigpXG4gICAge1xuICAgICAgICB2YXIgY3VycmVudE1pbiA9IGRpc3RhbmNlW3VudmlzaXRlZC5hdCgwKV07XG4gICAgICAgIHZhciBjdXJyZW50S2V5O1xuXG4gICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCB1bnZpc2l0ZWQubGVuZ3RoKCk7IGkrKylcbiAgICAgICAge1xuICAgICAgICAgICAgaWYoZGlzdGFuY2VbdW52aXNpdGVkLmF0KGkpXSA8PSBjdXJyZW50TWluKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRNaW4gPSBkaXN0YW5jZVt1bnZpc2l0ZWQuYXQoaSldXG4gICAgICAgICAgICAgICAgY3VycmVudEtleSA9IHVudmlzaXRlZC5hdChpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY3VycmVudEtleTtcbiAgICB9XG5cbiAgICAvLyBSZXNldHMgYXJlIHZhcmlhYmxlcy5cbiAgICB2YXIgcmVzZXRWYXJpYWJsZSA9IGZ1bmN0aW9uKF91bnZpc2l0ZWQsX2Rpc3RhbmNlKVxuICAgIHtcbiAgICAgICAgX3VudmlzaXRlZCA9IG5ldyBTZXQoKTtcbiAgICAgICAgX2Rpc3RhbmNlID0ge307XG4gICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuQWlycG9ydHMubGVuZ3RoOyBpKyspXG4gICAgICAgIHtcbiAgICAgICAgICAgIGRpc3RhbmNlWyRzY29wZS5BaXJwb3J0c1tpXS5JQVRBXSA9IE51bWJlci5NQVhfVkFMVUU7XG4gICAgICAgICAgICB1bnZpc2l0ZWQuYWRkKCRzY29wZS5BaXJwb3J0c1tpXS5JQVRBKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICRzY29wZS5jbGlja1JlcGVhdCA9IGZ1bmN0aW9uKClcbiAgICB7XG4gICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKylcbiAgICAgICAge1xuICAgICAgICAgICAgbGluZXNbaV0uc2V0TWFwKG51bGwpO1xuICAgICAgICB9XG4gICAgICAgIHNldE1hcE9uQWxsKG1hcCk7XG4gICAgICAgIGdldFRvLnZhbHVlID0gXCJcIjtcbiAgICAgICAgZ2V0RnJvbS52YWx1ZSA9IFwiXCI7XG4gICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3VsdFwiKTtcbiAgICAgICAgd2hpbGUgKGRpdi5oYXNDaGlsZE5vZGVzKCkpIHtcbiAgICAgICAgICAgIGRpdi5yZW1vdmVDaGlsZChkaXYubGFzdENoaWxkKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vPT09PT09PT09PVxuICAgIC8vIEEgR3JhcGggXG4gICAgLy89PT09PT09PT09XG4gICAgZnVuY3Rpb24gR3JhcGgoKSB7XG4gICAgICB0aGlzLnZlcnRpY2VzID0gW107XG4gICAgICB0aGlzLmVkZ2VzID0gW107XG4gICAgICB0aGlzLm51bWJlck9mRWRnZXMgPSAwO1xuICAgIH1cbiAgICBHcmFwaC5wcm90b3R5cGUuYWRkVmVydGV4ID0gZnVuY3Rpb24odmVydGV4KSB7XG4gICAgICAgIGlmKHRoaXMudmVydGljZXMuaW5kZXhPZih2ZXJ0ZXgpID09IC0xKVxuICAgICAgICB7XG4gICAgICAgICAgICB0aGlzLnZlcnRpY2VzLnB1c2godmVydGV4KTtcbiAgICAgICAgICAgIHRoaXMuZWRnZXNbdmVydGV4XSA9IFtdO1xuICAgICAgICB9ICAgICAgICBcbiAgICB9O1xuICAgIEdyYXBoLnByb3RvdHlwZS5hZGRFZGdlID0gZnVuY3Rpb24odmVydGV4MSwgdmVydGV4MiwgX2QpIHtcbiAgICAgICAgdmFyIHRlbXAgPSB7dG86dmVydGV4MiwgZGlzdGFuY2U6IF9kfTtcbiAgICAgICAgdGhpcy5lZGdlc1t2ZXJ0ZXgxXS5wdXNoKHRlbXApO1xuICAgICAgICB0aGlzLm51bWJlck9mRWRnZXMrKztcbiAgICB9O1xuICAgIEdyYXBoLnByb3RvdHlwZS5zaXplID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7XG4gICAgfTtcbiAgICBHcmFwaC5wcm90b3R5cGUuR2V0TmVpZ2ggPSBmdW5jdGlvbih2ZXJ0ZXgpXG4gICAge1xuICAgICAgICByZXR1cm4gdGhpcy5lZGdlc1t2ZXJ0ZXhdO1xuICAgIH1cblxuXG4gICAgXG4gICAgXG5cbiAgICAvLz09PT09PT09PVxuICAgIC8vIE91ciBTZXRcbiAgICAvLz09PT09PT09PVxuICAgIGZ1bmN0aW9uIFNldCgpIHtcbiAgICAgIHRoaXMudmFsdWVzID0gW107XG4gICAgICB0aGlzLm51bWJlck9mVmFsdWVzID0gMDtcbiAgICB9XG4gICAgU2V0LnByb3RvdHlwZS5hdCA9IGZ1bmN0aW9uKHZhbHVlKVxuICAgIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudmFsdWVzW3ZhbHVlXTtcbiAgICB9XG4gICAgU2V0LnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgaWYoIX50aGlzLnZhbHVlcy5pbmRleE9mKHZhbHVlKSkge1xuICAgICAgICB0aGlzLnZhbHVlcy5wdXNoKHZhbHVlKTtcbiAgICAgICAgdGhpcy5udW1iZXJPZlZhbHVlcysrO1xuICAgICAgfVxuICAgIH07XG4gICAgU2V0LnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgdmFyIGluZGV4ID0gdGhpcy52YWx1ZXMuaW5kZXhPZih2YWx1ZSk7XG4gICAgICBpZih+aW5kZXgpIHtcbiAgICAgICAgdGhpcy52YWx1ZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgdGhpcy5udW1iZXJPZlZhbHVlcy0tO1xuICAgICAgfVxuICAgIH07XG4gICAgU2V0LnByb3RvdHlwZS5sZW5ndGggPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLm51bWJlck9mVmFsdWVzO1xuICAgIH07XG4gICAgXG4gICAgLy8gQXNpZ24gYW4gb2JqZWN0IGEga2V5IGFuZCB2YWx1ZS5cbiAgICBmdW5jdGlvbiBhc3NpZ25PYmplY3Qob2JqLCBrZXlQYXRoLCB2YWx1ZSkge1xuICAgICAgIGxhc3RLZXlJbmRleCA9IGtleVBhdGgubGVuZ3RoLTE7XG4gICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsYXN0S2V5SW5kZXg7ICsrIGkpIHtcbiAgICAgICAgIGtleSA9IGtleVBhdGhbaV07XG4gICAgICAgICBpZiAoIShrZXkgaW4gb2JqKSlcbiAgICAgICAgICAgb2JqW2tleV0gPSB7fVxuICAgICAgICAgb2JqID0gb2JqW2tleV07XG4gICAgICAgfVxuICAgICAgIG9ialtrZXlQYXRoW2xhc3RLZXlJbmRleF1dID0gdmFsdWU7XG4gICAgfVxuXG59KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuICAgIC5jb25maWcoZnVuY3Rpb24gKCRyb3V0ZVByb3ZpZGVyKSB7XG4gICAgICAgIC8vIG15IHJvdXRlcy4uLiBtYWtlcyBsaWZlIGVhc3lcbiAgICAgICAgJHJvdXRlUHJvdmlkZXJcbiAgICAgICAgICAgIC53aGVuKCcvJyx7Y29udHJvbGxlcjogJ0FpcnBvcnRDdHJsJyx0ZW1wbGF0ZVVybDonL3RlbXBsYXRlcy9ob21lLmh0bWwnfSlcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKS5zZXJ2aWNlKCdBaXJwb3J0U3ZjJywgZnVuY3Rpb24gKCRodHRwKSB7XG5cbiAgICB2YXIgc3ZjID0gdGhpcztcbiAgICBzdmMuZ2V0QWlycG9ydHMgPSBmdW5jdGlvbigpXG4gICAgeyAgIFxuICAgIFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS9haXJwb3J0cy8nKVxuICAgIFx0LnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgIFx0XHRyZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICBcdH0pO1xuICAgIH1cblxuICAgIHN2Yy5nZXRSb3V0ZXMgPSBmdW5jdGlvbigpXG4gICAge1xuICAgIFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS9yb3V0ZXMvJylcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgc3ZjLmdldE9uZUFpcnBvcnQgPSBmdW5jdGlvbihJQVRBKVxuICAgIHtcbiAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS9haXJwb3J0cy8nK0lBVEEpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICB9KVxuICAgIH1cbn0pO1xuIl19
